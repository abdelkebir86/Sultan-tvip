<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ IPTV Ù…ØªÙ‚Ø¯Ù…</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: Arial, sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { text-align: center; }
        .video-container { width: 100%; max-width: 800px; }
        video { width: 100%; border-radius: 10px; }
        .controls { margin-top: 10px; text-align: center; }
        button, select { padding: 10px 15px; background: #2196F3; border: none; color: white; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        .loading { color: #2196F3; display: none; margin: 10px; }
        .channel-list { list-style: none; padding: 0; margin-top: 15px; width: 100%; max-width: 800px; height: 250px; overflow-y: auto; border: 1px solid #555; border-radius: 10px; background: #222; }
        .channel-item { padding: 10px; margin: 5px; background: #333; border-radius: 5px; cursor: pointer; transition: 0.3s; text-align: center; }
        .channel-item:hover { background: #2196F3; }
    </style>
</head>
<body>
    <h1>ğŸ¬ Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø®ØµØµØ©</h1>

    <div class="video-container">
        <video id="videoPlayer" controls></video>
    </div>

    <h2 id="channelName">ğŸ“º Ø§Ù„Ø¢Ù†: ØºÙŠØ± Ù…Ø­Ø¯Ø¯</h2>

    <div class="controls">
        <select id="sectionSelect">
            <option value="1000-2000">Ù…Ù† 1000 Ø¥Ù„Ù‰ 2000</option>
            <option value="2000-3000">Ù…Ù† 2000 Ø¥Ù„Ù‰ 3000</option>
            <option value="3000-4000">Ù…Ù† 3000 Ø¥Ù„Ù‰ 4000</option>
            <option value="4000-5000">Ù…Ù† 4000 Ø¥Ù„Ù‰ 5000</option>
            <option value="5000-6000">Ù…Ù† 5000 Ø¥Ù„Ù‰ 6000</option>
            <option value="6000-6566">Ù…Ù† 6000 Ø¥Ù„Ù‰ 6566</option>
        </select>
        <button onclick="loadCustomChannels()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</button>
    </div>

    <div class="loading" id="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</div>
    
    <ul class="channel-list" id="channelList"></ul>

    <script>
        const BASE_URL = "http://dw4t1jha.tvclub.xyz/iptv/SSVLTMCKNQ4NA8/";
        const M3U_FILE_URL = "https://www.dropbox.com/scl/fi/uzne46d1xh7o3gzgm10u6/Pasted_1986.m3u?rlkey=nfkwpo59buc6zolrgxtk7jy6s&dl=1";
        let channelDatabase = {}; // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
        let isDataLoaded = false; // Ù…ØªØºÙŠØ± Ù„Ù…Ø¹Ø±ÙØ© Ù‡Ù„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡

        document.addEventListener("DOMContentLoaded", async function() {
            await loadM3UFromServer();
        });

        async function loadM3UFromServer() {
            try {
                let response = await fetch(M3U_FILE_URL);
                let text = await response.text();

                console.log("ğŸ“Œ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù M3U:", text);
                channelDatabase = parseM3U(text);
                console.log("ğŸ“Œ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„:", channelDatabase);

                if (Object.keys(channelDatabase).length > 0) {
                    isDataLoaded = true;
                    showNotification("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¨Ù†Ø¬Ø§Ø­!");
                } else {
                    showNotification("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª.");
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù M3U:", error);
                showNotification("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª.");
            }
        }

        function parseM3U(m3uText) {
            const regex = /#EXTINF:\d+.*?,(.*?)\s+#EXTGRP:.*?\s+(http.*?\/(\d+)\/index\.m3u8)/g;
            const channels = {};
            let match;

            while ((match = regex.exec(m3uText)) !== null) {
                const channelName = match[1].trim();
                const channelNumber = match[3].trim();
                channels[channelNumber] = channelName;
            }

            console.log("ğŸ“Œ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:", channels);
            return channels;
        }

        function getSelectedSection() {
            const value = document.getElementById('sectionSelect').value;
            const [start, end] = value.split('-').map(Number);
            return { start, end };
        }

        function loadCustomChannels() {
            if (!isDataLoaded) {
                showNotification("âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¨Ø¹Ø¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...");
                console.error("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯.");
                return;
            }

            console.log("ğŸ“Œ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©:", channelDatabase);

            const { start, end } = getSelectedSection();
            const allChannels = [];

            for (let i = start; i <= end; i++) {
                const channelNumber = i.toString();
                const channelName = channelDatabase[channelNumber] || `ğŸ“º Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ© (${channelNumber})`;
                allChannels.push({
                    name: channelName,
                    url: `${BASE_URL}${channelNumber}/index.m3u8`
                });
            }

            console.log("ğŸ“Œ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:", allChannels);
            renderChannels(allChannels);
        }

        function renderChannels(channels) {
            const list = document.getElementById('channelList');
            list.innerHTML = channels.map(ch => `
                <li class="channel-item" onclick="playChannel('${ch.url}', '${ch.name}')">
                    ğŸ“º ${ch.name}
                </li>
            `).join('');
        }

        function playChannel(url, name) {
            const player = document.getElementById("videoPlayer");
            document.getElementById("channelName").textContent = `ğŸ“º Ø§Ù„Ø¢Ù†: ${name}`;

            if (Hls.isSupported() && url.endsWith(".m3u8")) {
                if (player.hls) player.hls.destroy();
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(player);
                player.hls = hls;
            } else {
                player.src = url;
            }

            player.play();
        }

        function showNotification(message) {
            const notif = document.createElement("div");
            notif.style = "position:fixed; top:20px; right:20px; background:#2196F3; padding:15px; border-radius:8px;";
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>